package repl

import (
	"bufio"
	"fmt"
	"io"
	"tyson/lexer"
	"tyson/parser"
)

const PROMPT = "üêï >> "

func Start(in io.Reader, out io.Writer) {
	scanner := bufio.NewScanner(in)
	for {
		fmt.Fprintf(out, PROMPT)
		scanned := scanner.Scan()
		if !scanned {
			return
		}
		line := scanner.Text()
		l := lexer.New(line)
		p := parser.New(l)
		program := p.ParseProgram()
		if len(p.Errors()) != 0 {
			printParserErrors(out, p.Errors())
			continue
		}
		io.WriteString(out, program.String())
		io.WriteString(out, "\n")
	}
}

const MONKEY_FACE = `
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£Ä‚£§‚†¥‚†í‚†í‚¢∂‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢∞‚°∂‚†∂‚†∂‚¢¶‚£Ñ‚£Ä‚£Ä‚£†‚†§‚¢∂‚£∫‚£ç‚°â‚¢∫‚£ø‚£∂‚£∂‚£Ñ‚†π‚°Ñ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£†‚°á‚†Ä‚†à‚†ô‚†ø‚£≠‚£∑‚£¶‚£§‚£å‚£â‚£õ‚†ª‚¢ø‚£ø‚£ø‚£ø‚£ø‚£¶‚£π‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£Ä‚°§‚†∂‚†æ‚£ç‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚†ô‚†ª‚†ø‚£ø‚£∂‚£ç‚†ª‚£ø‚£ø‚£ø‚£ø‚°á‚†Ä‚†Ä‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£†‚†û‚†ô‚¢¶‚£Ä‚†Ä‚†à‚†ô‚†í‚†í‚†í‚¢í‚£∂‚£∂‚£Ñ‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†ô‚¢ø‚£ø‚£Æ‚°õ‚£ß‚†Ä‚¢π‚£Ñ‚†Ä‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£Ä‚†§‚†ñ‚†ä‚†â‚†â‚†ì‚†∂‚†¶‚£Ñ‚£Ä‚†â‚†â‚†ø‚†Ä‚£Ä‚£â‚°†‚†§‚†§‚†∂‚¢≠‚£Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†â‚†ª‚¢ø‚£Æ‚£ü‚¢ø‚£ø‚£∑‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚°¥‚†ã‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢∂‚°Ä‚†Ä‚†Ä‚†π‚£∂‚†ö‚†ã‚†â‚†â‚†Å‚†Ä‚¢Ä‚£†‚†¥‚†ö‚†õ‚†ì‚†í‚¢≤‚£∂‚°§‚†Ñ‚†Ä‚†Ä‚†ê‚£æ‚¢ø‚£∑‚£ü‚¢ª‚°Ü‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£Ä‚°¥‚†ã‚£†‚†∂‚†õ‚†â‚†ë‚¢∂‚†Ä‚¢Ä‚°æ‚†∑‚°Ñ‚†Ä‚†Ä‚†à‚†ê‚£¶‚†Ä‚†Ä‚†Ä‚°∞‚†ã‚†Ä‚£†‚£∂‚£∂‚£∂‚£û‚£Ω‚£∂‚¢æ‚£ø‚£ø‚†∑‚£∂‚†ò‚£Ü‚†à‚†õ‚¢ø‚£∑‚°Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚°¥‚†õ‚†â‚†ô‚†æ‚£∑‚°Ñ‚°Ä‚†Ä‚¢†‚°û‚¢Ä‚¢®‚°á‚†Ä‚†Ä‚¢†‚°∂‚†û‚†õ‚¢ø‚°Ä‚†Ä‚†Ä‚°á‚†Ä‚†Ä‚†â‚¢ª‚£ø‚£ø‚£ø‚£©‚£∂‚†ø‚£ø‚£ø‚£ø‚°û‚£ß‚†à‚¢≥‚°Ä‚†Ä‚†â‚†Å
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£¥‚†ã‚£†‚†Ä‚†Ä‚¢†‚°ü‚£ø‚¢ø‚°á‚¢Ä‚°û‚¢Å‚°û‚¢∏‚°á‚†Ä‚†Ä‚†∏‚£á‚†Ä‚†Ä‚†Ä‚†±‚¢Ñ‚†Ä‚¢ß‚°Ä‚†Ä‚£Ä‚£Ä‚£π‚£ø‚£ø‚£ø‚¢°‚£¥‚£ø‚£ø‚£ø‚£∑‚¢ø‚°Ü‚†Ä‚†ô‚°Ü‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£º‚££‚°æ‚†É‚†Ä‚¢Ä‚°û‚£∞‚£ø‚£æ‚†Ä‚£æ‚†Ä‚°û‚¢Ä‚°ü‚†Ä‚†Ä‚¢Ä‚°¥‚¢ø‚£¶‚°Ñ‚†Ä‚†Ä‚†à‚¢∑‚£æ‚°ø‚†ü‚†õ‚†ø‚†ø‚£ø‚£ø‚£ø‚£¶‚°ù‚†ø‚†ø‚†ø‚££‚£ø‚£ø‚°Ü‚†Ä‚¢π‚°Ü‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£æ‚†ø‚£ø‚†Å‚†Ä‚†Ä‚£æ‚£ø‚£ø‚†ü‚†Å‚†∞‚†É‚¢∏‚†Å‚¢∏‚†Å‚£†‚†î‚†ã‚†Ä‚†Ä‚°π‚†ø‚£∑‚°Ñ‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£∞‚£ø‚£∂‚£¶‚£Ü‚†Ä‚†â‚†â‚†â‚†õ‚†ø‚£ø‚£ø‚£ø‚£∑‚†Ä‚†∏‚°á‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚°á‚£†‚£ø‚£∑‚£∂‚£æ‚£Ø‚£ø‚£ø‚†Ä‚†Ä‚†Ä‚†Ä‚°è‚†Ä‚£º‚°ú‚†Å‚¢†‚£¥‚£ø‚£∂‚£∑‚£¶‚£ü‚°á‚†Ä‚†Ä‚£†‚£æ‚£õ‚°ç‚¢ª‚£ø‚¢õ‚°ø‚£ø‚£∑‚£¶‚£§‚£§‚£§‚£Ñ‚°ô‚¢æ‚†á‚†Ä‚†Ä‚£á‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚£∞‚£∑‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚°è‚†Ä‚†Ä‚†Ä‚†Ä‚¢Å‚°¥‚†ã‚£†‚£∂‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚°ø‚†Ä‚†§‚£¥‚°ü‚¢∫‚£∑‚°Ω‚£¶‚°ª‚†ü‚¢∂‚°Ñ‚°Æ‚†≠‚†ç‚†ø‚¢Ø‚£ü‚£ª‚¢ß‚°à‚¢∑‚¢ß‚¢∏‚°Ä
‚†Ä‚†Ä‚†Ä‚£∞‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£á‚†Ä‚†Ä‚†Ä‚†Ä‚°ü‚¢†‚¢æ‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚¢ø‚°Ñ‚†Ä‚£ª‚£ø‚£Ä‚°¥‚†õ‚†á‚¢ª‚£ª‚£∂‚†É‚†ô‚£É‚£§‚°¥‚†Ç‚†Ä‚†Ä‚£§‚£§‚£ô‚£¶‚£º‚£ø‚†á
‚†Ä‚†Ä‚£∏‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚†Ä‚†Ä‚†Ä‚¢Ä‚°á‚†Ä‚£º‚£ø‚£ø‚£â‚£©‚£ø‚£æ‚£ø‚£æ‚°á‚†Ä‚†Ä‚£ø‚£Ø‚£æ‚£≠‚£Ø‚°ø‚†Å‚†ô‚£∑‚£†‚£∂‚£∂‚†∂‚¢Ä‚£Ä‚°Ä‚†ô‚†ª‚¢ø‚£ç‚†â‚¢ø‚†Ä
‚†Ä‚£¥‚£ø‚£ø‚£ø‚£ø‚£ø‚°ü‚°ø‚†ª‚†õ‚†ø‚£ø‚£è‚†Ä‚†Ä‚†Ä‚†∏‚°á‚†Ä‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚†ü‚£∏‚°á‚†Ä‚¢†‚£ø‚£Ω‚£∑‚†ü‚£ç‚†Ä‚†Ä‚¢†‚£ø‚°ø‚†õ‚†õ‚†õ‚†ª‚£∑‚£ø‚£ì‚†Ä‚£†‚£å‚†Å‚¢∏‚°Ñ
‚†Ä‚£ø‚†π‚£ø‚£ø‚£ø‚£ø‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚£ø‚†ª‚£¶‚°Ä‚†Ä‚†Ä‚†±‚£Ñ‚£ø‚£Æ‚£â‚†õ‚†õ‚¢ã‚†µ‚£≤‚£ø‚†Ä‚¢Ä‚°æ‚£ø‚£õ‚£ø‚¢ø‚°è‚†Ä‚†Ä‚°æ‚†É‚†Ä‚†Ä‚†Ä‚†Ä‚¢§‚£∏‚£ø‚£ø‚£ß‚°ª‚†ø‚†•‚¢∏‚°á
‚†Ä‚†à‚†≥‚¢ø‚£ø‚£ø‚£ø‚£§‚£Ä‚£§‚£Ä‚£º‚£ø‚£Ü‚¢ª‚°≥‚†Ñ‚†Ä‚†Ä‚†à‚¢ø‚†ª‚¢ø‚£ø‚£ø‚°Ø‚†æ‚†ã‚£ø‚†Ä‚£æ‚£ß‚£ü‚°è‚†Å‚°ø‚†É‚†Ä‚£æ‚†É‚†Ä‚†Ä‚£ß‚£ß‚£†‚£Ω‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚†ø‚†ü‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†â‚†ª‚¢ø‚£ø‚£ø‚£ø‚£ø‚£ø‚°á‚†ò‚£Ñ‚¢ß‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£á‚†Ä‚†à‚†ô‚†≤‚†∂‚¢¥‚£ø‚¢†‚£ø‚†æ‚£º‚¢Ä‚£º‚†Ä‚†Ä‚£∏‚£ø‚£ø‚£Ü‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚¢Ø‚†Å‚†Ä‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†â‚†õ‚†ø‚†ø‚¢´‚°Ñ‚†Ä‚†π‚£é‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢∏‚°Ü‚†Ä‚†Ä‚†ò‚£¶‚†Ä‚¢π‚°é‚¢π‚°Ñ‚¢Ä‚£º‚†á‚†Ä‚¢∞‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚°ø‚†ü‚†Å‚¢∏‚†Ä‚†Ä‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†ô‚¢¶‚†Ä‚†ô‚¢¶‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚¢ª‚£§‚°Ä‚†Ä‚†ò‚£Ü‚¢∏‚£ø‚†Ä‚¢≥‚†â‚¢¥‚¢Ä‚†Ä‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚°ø‚†ø‚†ã‚¢π‚†á‚†Ä‚†Ä‚¢∏‚†Ä‚†Ä‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚¢≥‚°Ñ‚†à‚¢≥‚£Ñ‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚†â‚†ô‚†ì‚†ø‚£ü‚°õ‚¢¶‚°à‚£∑‚†ê‚†Å‚£º‚£ø‚£ø‚£ø‚°ø‚†ü‚†õ‚†Å‚†Ä‚†Ä‚£∞‚†è‚†Ä‚†Ä‚†Ä‚£∏‚†Ä‚†Ä‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†ô‚¢¶‚°Ä‚†ô‚†≥‚£ù‚¢¶‚£Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£à‚£©‚°∑‚†ø‚£ø‚†∞‚£æ‚†ø‚†ü‚†ã‚†ô‚¢¶‚°Ä‚†Ä‚†Ä‚†Ä‚£∞‚£á‚£Ä‚£†‚†¥‚¢æ‚°ü‚†Ä‚†Ä‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†â‚†≥‚£Ñ‚°ô‚†∑‚£Ñ‚£â‚†ô‚†õ‚†õ‚†â‚†Å‚†Ä‚†Ä‚£Ä‚°º‚†õ‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚¢≥‚†Ä‚†Ä‚£∞‚†ã‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†ô‚†¶‚£å‚°â‚†ô‚†í‚†∂‚†§‚†∂‚†ñ‚†ä‚†â‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚£ß‚°û‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†ô‚†≥‚£Ñ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†∏‚†É‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚¢∑‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚††‚†Ä‚††‚†§‚°§‚£§‚£§‚¢§‚¢§‚¢§‚°§‚°§‚†§‚¢§‚†§‚†§‚†§‚†§‚†§‚†§‚†§‚†§‚†§‚†§‚†§‚†§‚†§‚†§‚†§‚†§‚†§‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
‚¢Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†â‚°Ä‚°Ä‚†à‚†â‚†â‚†Å‚†à‚†â‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
`

func printParserErrors(out io.Writer, errors []string) {
	io.WriteString(out, MONKEY_FACE)
	io.WriteString(out, "Woops! We ran into some nasty business here!\n")
	io.WriteString(out, " parser errors:\n")
	for _, msg := range errors {
		io.WriteString(out, "\t"+msg+"\n")
	}
}
